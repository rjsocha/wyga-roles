- name: "Install {{ repository }} repository / Target  ..."
  set_fact:
    repository_legacy: "{{ true if target in ['debian', 'ubuntu'] and version in ['12', '22.04'] else false }}"

- name: "Install {{ repository }} repository / Legacy Format ..."
  block:
    - name: "Install {{ repository }} repository ..."
      copy:
        src: "repository/{{ repository }}/common/{{ file.src }}"
        dest: "{{ file.dst }}"
        group: root
        owner: root
        mode: 0644
        force: yes
      loop:
        - { 'src': 'file/{{ repository }}.gpg',  'dst': '/usr/share/keyrings/{{ repository }}.gpg' }
        - { 'src': 'file/{{ arch }}/{{ repository }}.list', 'dst': '/etc/apt/sources.list.d/{{ repository }}.list' }
      loop_control:
        loop_var: file
        label: "{{ file.dst }}"
  when: repository_legacy

- name: "Install {{ repository }} repository / deb822 Format ..."
  block:
    - name: "Install {{ repository }} repository ..."
      copy:
        src: "repository/{{ repository }}/common/{{ file.src }}"
        dest: "{{ file.dst }}"
        group: root
        owner: root
        mode: 0644
        force: yes
      loop:
        - { 'src': 'file/{{ repository }}.gpg',  'dst': '/usr/share/keyrings/{{ repository }}.gpg' }
        - { 'src': 'file/{{ arch }}/{{ repository }}.sources', 'dst': '/etc/apt/sources.list.d/{{ repository }}.sources' }
      loop_control:
        loop_var: file
        label: "{{ file.dst }}"

    - name: "Cleanup {{ repository }} repository ..."
      file:
        path: "{{ file.purge }}"
        state: absent
      loop:
        - { 'purge': '/etc/apt/sources.list.d/wyga.list' }
      loop_control:
        loop_var: file
        label: "{{ file.purge }}"
  when: not repository_legacy
